### 第一阶段：图像预处理与边缘提取 (Spatial Domain Processing)

此阶段的目标是从包含噪点和色彩信息的原始位图信号中，通过离散卷积运算提取出高梯度的几何轮廓数据。

1.  **灰度化映射 (Grayscale Conversion)**
    *   **输入**：RGB 颜色空间的位图矩阵 $I_{RGB}$，尺寸为 $W \times H$。
    *   **操作**：将三通道颜色分量线性映射为单通道亮度标量 $Y$。
    *   **数学定义**：对于图像域 $\Omega = \{ (x, y) \mid 0 \le x < W, 0 \le y < H \}$ 中的每一个像素，计算：
        $$ Y(x,y) = 0.299 \cdot R(x,y) + 0.587 \cdot G(x,y) + 0.114 \cdot B(x,y) $$

2.  **梯度卷积 (Gradient Convolution)**
    *   **算子定义**：采用 **Sobel 算子** 计算图像亮度的空间梯度。定义水平核 $K_x$ 和垂直核 $K_y$：
        $$ K_x = \begin{bmatrix} -1 & 0 & 1 \\ -2 & 0 & 2 \\ -1 & 0 & 1 \end{bmatrix}, \quad K_y = \begin{bmatrix} -1 & -2 & -1 \\ 0 & 0 & 0 \\ 1 & 2 & 1 \end{bmatrix} $$
    *   **卷积运算**：
        $$ G_x = K_x * Y $$
        $$ G_y = K_y * Y $$
        其中 $*$ 表示二维离散卷积。
    
3.  **幅值计算与阈值分割 (Magnitude Calculation & Thresholding)**
    *   **梯度幅值**：计算每个像素点的梯度向量模长：
        $$ G(x,y) = \sqrt{G_x(x,y)^2 + G_y(x,y)^2} $$
    *   **二值化判决**：设定阈值 $\tau$。构建边缘点集合 $S_{raw}$：
        $$ S_{raw} = \{ (x, y) \mid G(x,y) > \tau \} $$

---

### 第二阶段：拓扑路径构建 (Topological Path Construction)

此阶段将离散的、无序的像素点集 $S_{raw}$ 转换为空间上连续的有序序列。

1.  **坐标系中心化 (Coordinate Centering)**
    *   对集合 $S_{raw}$ 中的任意点 $p_i = (x_i, y_i)$ 进行平移变换，使其相对于图像中心分布：
        $$ x'_i = x_i - \frac{W}{2}, \quad y'_i = y_i - \frac{H}{2} $$
    *   更新后的点集记为 $P'_{raw}$。

2.  **最近邻路径排序 (Nearest Neighbor Sorting)**
    *   **初始化**：设 $P_{sorted}$ 为空序列，从 $P'_{raw}$ 中选取任意一点作为起始点 $v_0$，加入 $P_{sorted}$，并从 $P'_{raw}$ 中移除。
    *   **迭代**：设当前点为 $v_{curr}$。在剩余点集中寻找点 $v_{next}$，使得欧几里得距离 $\| v_{curr} - v_{next} \|$ 最小。
    *   **更新**：将 $v_{next}$ 加入 $P_{sorted}$，标记为已访问。重复直至所有点被遍历。
    *   **输出**：得到有序序列 $P_{sorted} = [p_0, p_1, \dots, p_{N-1}]$，其中 $N$ 为原始边缘点数量。

---

### 第三阶段：信号重采样与参数化 (Signal Resampling & Parameterization)

此阶段旨在解决原始路径点分布不均及点数非 $2$ 幂次的问题，将空间路径转换为适合 FFT 输入的等时（等弧长）复数信号。

1.  **路径闭合 (Path Closure)**
    *   为了保证信号的周期连续性，计算 $p_0$ 与 $p_{N-1}$ 的距离。若距离非零，将 $p_0$ 追加至序列末尾。此时序列长度为 $N+1$，记点为 $p_0, \dots, p_N$。

2.  **弧长参数化 (Arc Length Parameterization)**
    *   计算路径上的累积弦长 $D_i$。定义 $D_0 = 0$。
    *   对于 $i = 1, \dots, N$：
        $$ d_i = \| p_i - p_{i-1} \| = \sqrt{(x'_i - x'_{i-1})^2 + (y'_i - y'_{i-1})^2} $$
        $$ D_i = D_{i-1} + d_i $$
    *   路径总长度定义为 $L_{total} = D_N$。

3.  **等距网格生成 (Uniform Grid Generation)**
    *   设定重采样点数 $M$，要求 $M$ 为 $2$ 的整数次幂（如 $1024, 2048$），且通常 $M \ll N$ 或 $M \approx N$ 视精度需求而定。
    *   构建均匀采样位置序列 $u_k$：
        $$ u_k = \frac{k}{M} \cdot L_{total}, \quad k = 0, 1, \dots, M-1 $$

4.  **线性插值重采样 (Linear Interpolation)**
    *   对于每个采样位置 $u_k$，在累积弦长序列 $\{D_0, \dots, D_N\}$ 中寻找索引 $i$，满足 $D_i \le u_k < D_{i+1}$。
    *   计算局部比例参数 $\alpha$：
        $$ \alpha = \frac{u_k - D_i}{D_{i+1} - D_i} $$
    *   计算重采样点坐标 $z_k$：
        $$ z_k = (1-\alpha) \cdot p_i + \alpha \cdot p_{i+1} $$
    *   **复平面映射**：将 $z_k = (x_k, y_k)$ 映射为离散复数信号：
        $$ x[k] = x_k + i \cdot y_k, \quad k = 0, \dots, M-1 $$

---

### 第四阶段：频域变换与系数解析 (Frequency Domain Analysis)

利用快速傅里叶变换 (FFT) 将时域离散信号分解为频域分量。

1.  **快速傅里叶变换 (FFT)**
    *   对序列 $x[k]$ 进行 FFT 运算，得到频域序列 $X_{raw}$，长度为 $M$：
        $$ X_{raw}[j] = \sum_{k=0}^{M-1} x[k] \cdot e^{-i \frac{2\pi}{M} j k}, \quad j = 0, \dots, M-1 $$

2.  **归一化 (Normalization)**
    *   对频域系数进行归一化处理，得到物理复振幅：
        $$ C[j] = \frac{X_{raw}[j]}{M} $$

3.  **频率索引映射 (Frequency Index Mapping)**
    *   FFT 输出数组的索引 $j$ 并非直接对应物理旋转频率。需要构建映射函数 $K_{rot}(j)$ 将数组索引转换为旋转阶数：
        $$
        K_{rot}(j) =
        \begin{cases}
        j & \text{若 } 0 \le j < \frac{M}{2} \quad (\text{正频率/逆时针}) \\
        j - M & \text{若 } \frac{M}{2} \le j < M \quad (\text{负频率/顺时针})
        \end{cases}
        $$

4.  **分量提取与结构化 (Component Extraction)**
    *   对于每个索引 $j \in [0, M-1]$，提取描述一个旋转圆所需的三个物理量，构成集合 $\Psi$：
        *   **频率 (Frequency)**: $\omega_j = K_{rot}(j)$
        *   **幅值 (Amplitude)**: $A_j = |C[j]| = \sqrt{\text{Re}(C[j])^2 + \text{Im}(C[j])^2}$
        *   **相位 (Phase)**: $\phi_j = \text{atan2}(\text{Im}(C[j]), \text{Re}(C[j]))$
    *   每个分量可表示为元组：$E_j = (\omega_j, A_j, \phi_j)$。

5.  **频谱排序 (Spectrum Sorting)**
    *   为了优化可视化效果（大圆带动小圆），依据幅值 $A_j$ 对集合 $\{E_j\}$ 进行降序排列。
    *   排序后的序列记为 $\mathbb{E} = [E'_0, E'_1, \dots, E'_{M-1}]$，其中 $E'_0$ 对应幅值最大的分量（通常是直流分量或基频分量）。

---

### 第五阶段：矢量重构与渲染 (Reconstruction & Visualization)

基于逆离散傅里叶变换 (IDFT) 的几何意义进行动画渲染。

1.  **时间定义**
    *   定义归一化时间参数 $t \in [0, 2\pi)$。
    *   帧增量 $\Delta t = \frac{2\pi}{\text{TotalFrames}}$。

2.  **矢量链递归计算 (Recursive Vector Calculation)**
    *   在任意时刻 $t$，位置向量 $V(t)$ 由所有频率分量的旋转矢量叠加而成。
    *   令 $V_0(t) = (0, 0)$ （屏幕中心或偏置坐标）。
    *   对于 $n = 0$ 到 $M-1$（遍历排序后的分量 $E'_n$）：
        *   当前圆的频率为 $\omega'_n$，半径为 $A'_n$，初始相位为 $\phi'_n$。
        *   计算当前矢量的复数值：
            $$ v_n(t) = A'_n \cdot e^{i(\omega'_n t + \phi'_n)} $$
            展开为笛卡尔坐标：
            $$ \Delta x_n = A'_n \cos(\omega'_n t + \phi'_n) $$
            $$ \Delta y_n = A'_n \sin(\omega'_n t + \phi'_n) $$
        *   计算第 $n$ 个圆的圆心位置（即上一个矢量的末端）：
            $$ C_n = V_n(t) = V_{n-1}(t) + (\Delta x_{n-1}, \Delta y_{n-1}) $$
            *注：$V_{-1}(t)$ 定义为全局原点。*
            第 $n$ 个圆心位置 $Pos_{center, n} = \sum_{k=0}^{n-1} v_k(t)$。
            第 $n$ 个矢量末端位置 $Pos_{end, n} = Pos_{center, n} + v_n(t)$。

3.  **渲染图元 (Rendering Primitives)**
    *   **圆**：以 $Pos_{center, n}$ 为圆心，$A'_n$ 为半径绘制空心圆。
    *   **半径线**：连接 $Pos_{center, n}$ 与 $Pos_{end, n}$。
    *   **轨迹**：记录最后一个分量 $Pos_{end, M-1}$ 在所有历史帧中的位置，绘制为连续曲线。

4.  **闭环验证**
    *   当 $t = 2\pi$ 时，$Pos_{end, M-1}$ 理论上应精确回到 $t=0$ 时的位置，轨迹形成闭合图形，完成一次完整循环。

---

### 第六阶段：技术流程综述 (Technical Process Summary)

本技术方案实现了从静态光栅图像到动态矢量频域描述的完整数学变换。

1.  **数据流转拓扑 (Data Flow Topology)**
    *   **$\mathbb{R}^{W \times H \times 3} \to \mathbb{R}^{2}$**：通过亮度加权与卷积梯度计算，将三维颜色矩阵降维为二维离散边缘点集。
    *   **$\{P_{unordered}\} \to \{P_{ordered}\}$**：通过最近邻算法（TSP近似解），引入序列约束，建立点的拓扑连接关系。
    *   **$\{P_{ordered}\} \to \mathbb{C}^{M}$**：通过弧长参数化与线性插值，将非均匀的空间点序列重映射为均匀分布的时域复数信号。
    *   **$\mathbb{C}^{M} \to \mathbb{C}^{M}$ (Frequency)**：通过离散傅里叶变换 (DFT/FFT)，将时域轨迹正交分解为频域上的旋转相量集合。
    *   **$\mathbb{C}^{M} \to \mathbb{R}^{2}(t)$**：通过逆变换的几何形式，将抽象频率系数具象化为随时间 $t$ 演变的平面矢量和。
2.  **核心算法依赖 (Core Algorithm Dependencies)**
    *   **Sobel Convolution**：确保边缘提取的梯度敏感性与方向性。
    *   **Nearest Neighbor Search**：确保路径的几何连续性，最小化信号突变。
    *   **Linear Interpolation (Resampling)**：确保 FFT 输入满足采样定理且分布均匀，消除时域抖动。
    *   **Cooley-Tukey FFT**：以 $O(M \log M)$ 的复杂度高效计算频谱系数。
    *   **Complex Plane Rotation**：基于欧拉公式 $e^{ix} = \cos x + i \sin x$ 实现纯几何的动画重构。

